"use strict";function cachePostInput(){var t=$(this),e=JSON.parse(Cookies.get("new_post"));e[t.attr("name")]=t.val(),Cookies.set("new_post",e,{expires:7})}function readInputCache(){var t=JSON.parse(Cookies.get("new_post"));for(var e in t)$('input[name="'+e+'"').val(t[e]),"hero-img"===e&&$(".post-hero").css({background:'url("http://'+window.location.host+t[e]+'")',"background-size":"cover"}),"content"===e&&tinymce.activeEditor.setContent(t[e])}function removeInputCache(){Cookies.remove("new_post")}function uploadPost(){tinymce.activeEditor.uploadImages(function(t){var e=new XMLHttpRequest;e.open("POST","/cruiser_reports"),e.onload=function(){var t=JSON.parse(e.responseText);"200"==t.status?(removeInputCache(),window.location=t.url):"504"==t.status&&showTipMsg("上传失败: "+t.msg,0)};var n=tinymce.activeEditor.save(),a=getQuoteText(n);$("input[name=content]").val(n),$("input[name=quote]").val(a);var o=new FormData($("form#frm")[0]);o.append("username",Cookies.get("username")),o.append("email",Cookies.get("email")),e.send(o),console.log(9)})}function initMce(t,e){tinymce.init({selector:t,skin:"mxc1",language:"zh_CN",content_css:"/stylesheets/dist/travelogue.min.css",body_class:"travelogue",plugins:["autoresize","advlist","autolink","lists","link","image","charmap","print","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","paste","imagetools"],toolbar:"undo redo styleselect fontsizeselect bold italic underline alignleft aligncenter alignright alignfull advlist lists link",image_caption:!0,paste_data_images:!0,fontsize_formats:"8pt 9pt 10pt 11pt 12pt 14pt 18pt 24pt",menubar:!1,images_upload_url:"/upload/images",statusbar:!1,min_height:480,setup:function(t){t.on("change",function(e){var n=t.save();$("input[name=content]").val(n).change()}),t.on("init",function(t){readInputCache()})}})}function uploadPic(){var t=$(this).next("img"),e=$(this).find("#pic-loader"),n=$(this).find("label"),a=$("<input>").attr({type:"file","class":"temp-input"}).css({display:"none",position:"absolute"}).change(function(){if(this.files&&this.files[0]){var a=new FileReader;a.onload=function(e){t.attr("src",e.target.result)},a.readAsDataURL(this.files[0]),n.removeClass("btn").addClass("pct");var o=function(t){var a=Math.ceil(100*t.loaded/t.total),o=100-a;e.css({height:o+"px"}),n.text(a+"%")},i=new XMLHttpRequest;i.withCredentials=!1,i.open("POST","/images"),i.onload=function(){var e=JSON.parse(i.responseText);console.log(e.location),t.attr("src",e.location),n.removeClass("pct").addClass("btn").text("change"),$(".temp-input").remove()},i.upload.addEventListener("progress",o,!1);var s=new FormData;s.append("image",this.files[0],this.files[0].name),i.send(s)}});$("body").append(a),a.click()}function uploadHero(){var t=$(".post-hero"),e=$("<input>").attr({type:"file","class":"temp-input"}).css({display:"none",position:"absolute"}).change(function(){if(this.files&&this.files[0]){var e=new FileReader;e.onload=function(e){t.css({background:'url("'+e.target.result+'")',"background-size":"cover"})},e.readAsDataURL(this.files[0]);var n=new XMLHttpRequest;n.withCredentials=!1,n.open("POST","/upload/images"),n.onload=function(){var e=JSON.parse(n.responseText);t.css({background:'url("http://'+window.location.host+e.location+'")',"background-size":"cover"}),$(".input-hero-img").val(e.location).change(),$(".temp-input").remove()};var a=new FormData;a.append("image",this.files[0],this.files[0].name),n.send(a)}});$("body").append(e),e.click()}function computProgress(t){var e=Math.ceil(1e3*t.loaded/t.total)/10+"%";return e}function GetCurrentDate(){var t=new Date,e=t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1,n=t.getFullYear()+"-"+e+"-"+t.getDate();return n}function getQuoteText(t){var e="";return $(t).find("*").each(function(){return $(this).text().length>32?(e=$(this).text(),!1):void 0}),e}$(document).ready(function(){function t(){var t=this,e=$(t).next(".result");$.get("http://api.geonames.org/searchJSON?lang=ZH&username=zhouzoro&maxRows=10&q="+$(t).val(),function(t){e.empty(),0===t.geonames.length&&e.append("No Results Found");var n=!0,a=!1,o=void 0;try{for(var i,s=t.geonames[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var r=i.value,c=$("<li>").attr("class","geoname-resultlist-item"),l=$("<a>").attr("data-id",r.geonameId).append($("<span>").attr("class","name").text(r.name)).append($("<span>").attr("class","toponymName").text("("+r.toponymName+")"));r.countryName&&""!==r.countryName&&l.append($("<span>").attr("class","countryName").text(", "+r.countryName)).append($("<span>").attr("class","toponymName").text("("+r.toponymName+")")),e.append(c.append(l))}}catch(p){a=!0,o=p}finally{try{!n&&s["return"]&&s["return"]()}finally{if(a)throw o}}})}Cookies.get("new_post")||Cookies.set("new_post",{}),initMce("#input-body"),$("form#frm").find("input").change(cachePostInput),$("#btn-img").click(function(){var t=$("<input>").attr({type:"file","class":"temp-input"}).css({display:"none",position:"absolute"}).change(function(){if(this.files&&this.files[0]){var t=new FileReader;t.onload=function(t){tinymce.activeEditor.execCommand("insertHTML",!1,'<img class="inline-img" src="'+t.target.result+'" width="100%" >'),tinymce.activeEditor.uploadImages()},t.readAsDataURL(this.files[0])}$(".temp-input").remove()});$("body").append(t),t.click()}),$(".geosearch").keyup(t).change(t)}),$(".add-btn").click(function(){var t=$("<div>").attr("class","expand-transition");$(this).append(t);var e=$(this).data("url"),n=$(this).data("type");$.get(e,function(e){$("#modal-cust").find(".container").html(e),$("#btn-cancel").click(function(){$("#body").show(),$("#modal-cust").hide("fast"),$("#modal-cust").find(".container").html("")}),$("#modal-cust").show("slow"),$("#body").hide("slow"),initUploadOf(n),t.remove(),$("#edit-pic").click(uploadPic)})});
//# sourceMappingURL=../maps/post.babeled.min.js.map
