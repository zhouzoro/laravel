{"version":3,"sources":["main.babeled.min.js","main.babeled.js"],"names":["addTocItem","$item","tocContainer","$","this","newItem","attr","href","class","prop","append","getTOC","console","log","tocTarget","data","h2count","find","each","goBack","document","referrer","indexOf","window","location","host","history","back","logOut","Cookies","remove","login","validateInputs","xhr","XMLHttpRequest","open","onload","res","JSON","parse","responseText","status","showTipMsg","set","username","expires","email","msg","showInputValidation","formData","FormData","send","signup","setLogin","get","addClass","removeClass","text","setReplistNav","$list","listPos","listLen","length","currentPos","up","css","down","click","setInfoNav","width","height","toggleSidebar","sidebar","ScrollTop","body","stop","animate","scrollTop","showScrollTop","checkVisible","changeToolBarPosition","$mceToolbar","$editorOps","elm","evalType","vpH","st","y","offset","top","elementHeight","scrollTo","eleId","validateEmail","re","test","txt","isok","color","background","border","inputName","$input","$inputContainer","focus","change","validateInput","val","validatePwd","issignup","password","regx","getQuoteText","htmlStr","p","ready","carousel","interval","popup","position","on","Vue","el","name","submitFuncs","methods","switchPage","submit","scrollStatus","scrollRecord","init","setPosition","recordScroll","direction","continuous","adaptResize","resize","scroll"],"mappings":"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","file":"main.babeled.min.js","sourcesContent":["'use strict';\n\n$(document).ready(function () {\n    setLogin();\n    $('.carousel').carousel({\n        interval: 8000\n    });\n\n    $('#toc').each(getTOC);\n    setReplistNav();\n    setInfoNav();\n\n    $('.user-button.button').popup({\n        popup: $('.user-ops-popup.popup'),\n        position: 'bottom right',\n        on: 'click'\n    });\n\n    if ($('#login').length) {\n        console.log(1);\n        var loginCtrl = new Vue({\n            el: '#login',\n            data: {\n                issignup: 0,\n                name: ['登录', '注册'],\n                submitFuncs: [login, signup]\n            },\n            methods: {\n                switchPage: function switchPage() {\n                    this.issignup = 1 - this.issignup;\n                },\n                submit: function submit() {\n                    this.submitFuncs[this.issignup]();\n                }\n            }\n        });\n    }\n    var scrollStatus = {\n        scrollRecord: [0, 0],\n        init: function init() {\n            scrollStatus.setPosition();\n        },\n        setPosition: function setPosition() {\n            scrollStatus.position = $(window).scrollTop();\n        },\n        recordScroll: function recordScroll() {\n            scrollStatus.scrollRecord[1] = scrollStatus.scrollRecord[0];\n            scrollStatus.scrollRecord[0] = $(window).scrollTop() > scrollStatus.position ? -1 : 1;\n            scrollStatus.position = $(window).scrollTop();\n            scrollStatus.direction = scrollStatus.scrollRecord[0] === -1 ? 'down' : 'up';\n            scrollStatus.continuous = scrollStatus.scrollRecord[0] === scrollStatus.scrollRecord[1];\n        },\n        adaptResize: function adaptResize() {\n            scrollStatus.init();\n        }\n    };\n    scrollStatus.init;\n    changeToolBarPosition();\n    $(window).resize(scrollStatus.adaptResize);\n\n    // changeHeaderOrNot();\n    $(document).scroll(function () {\n        changeToolBarPosition();\n    });\n});\n\nfunction addTocItem($item) {\n    var tocContainer = $(this);\n    var newItem = $('<a>').attr({ 'href': $item.attr('id'), 'class': 'toc-item ' + $item.prop(\"tagName\") });\n    tocContainer.append(newItem);\n}\n\nfunction getTOC() {\n    console.log('adding toc');\n    var tocContainer = $(this);\n    tocContainer.addTocItem = addTocItem;\n    var tocTarget = $(tocContainer.data('target'));\n    var h2count = 0;\n    tocTarget.find('h2').each(function () {\n        $(this).attr('id', 'h2' + '-' + h2count);\n        tocContainer.addTocItem($(this));\n        var h3count = 0;\n        $(this).find('h3').each(function () {\n            $(this).attr('id', 'h3' + '-' + h2count);\n            tocContainer.addTocItem($(this));\n        });\n    });\n}\n\nfunction goBack() {\n    if (document.referrer.indexOf(window.location.host) !== -1) {\n        history.back();\n    }\n}\n\nfunction logOut() {\n    //remove cookies and redirect to root page\n    Cookies.remove('email');\n    Cookies.remove('username');\n    window.location = '/';\n}\n\nfunction login() {\n    if (!validateInputs()) return 0;\n\n    var xhr = new XMLHttpRequest();\n    xhr.open('POST', '/login');\n\n    xhr.onload = function () {\n        var res = JSON.parse(xhr.responseText);\n        console.log(res);\n        if (res.status == '200') {\n            goBack();\n            showTipMsg('登录成功', 1);\n            Cookies.set('username', res.username, { expires: 7 });\n            Cookies.set('email', res.email, { expires: 7 });\n        } else if (res.status == '504') {\n            showTipMsg('登录失败: ' + res.msg, 0);\n            showInputValidation(\"email\", 0);\n        }\n    };\n\n    var formData = new FormData($('form#login')[0]);\n    xhr.send(formData);\n}\n\nfunction signup() {\n    if (!validateInputs(1)) return 0;\n\n    var xhr = new XMLHttpRequest();\n    xhr.open('POST', '/signup');\n\n    xhr.onload = function () {\n        var res = JSON.parse(xhr.responseText);\n        if (res.status == '200') {\n            goBack();\n            showTipMsg('注册成功', 1);\n            Cookies.set('email', res.email, { expires: 7 });\n            Cookies.set('username', res.username, { expires: 7 });\n        } else if (res.status == '504') {\n            showTipMsg('注册失败: ' + res.msg, 0);\n            showInputValidation(\"email\", 0);\n        }\n    };\n\n    var formData = new FormData($('form#login')[0]);\n    xhr.send(formData);\n}\n\nfunction setLogin() {\n    if (Cookies.get('email')) {\n        /**\r\n         * if logged in, do:\r\n         * 1. show user pic instead of login options\r\n         * 2. set login cookies\r\n         */\n        $('.login-ops').addClass('hidden');\n        $('.user-ops').removeClass('hidden');\n        $('label.username').text(Cookies.get('username'));\n        $('.user-access-btn').addClass('disabled');\n\n        Cookies.set('email', Cookies.get('email'), { expires: 7 });\n        Cookies.set('username', Cookies.get('username'), { expires: 7 });\n    }\n}\n\nfunction setReplistNav() {\n    if (!$('.report-intro-list-nav')[0]) return;\n\n    var $list = $('.report-intro-list');\n    var listPos = function () {\n        var listLen = $('.report-intro-list .item').length;\n        var currentPos = 1;\n        return {\n            up: function up() {\n                if (currentPos > 2) {\n                    currentPos = currentPos - 2;\n                } else {\n                    currentPos = 1;\n                }\n                $list.css('transform', 'translateY(' + (1 - currentPos) * 108 + 'px)');\n            },\n\n            down: function down() {\n                if (listLen - currentPos > 2) {\n                    currentPos = currentPos + 2;\n                } else {\n                    currentPos = listLen - 1;\n                }\n                $list.css('transform', 'translateY(' + (1 - currentPos) * 108 + 'px)');\n            }\n        };\n    }();\n    var $up = $('.report-intro-list-nav.up').click(listPos.up);\n    var $down = $('.report-intro-list-nav.down').click(listPos.down);\n}\n\nfunction setInfoNav() {\n    if (!$('.info-center')[0]) return;\n    var $list = $('.info-content-list');\n    $('.service-menu .item').click(function () {\n        var width = $('.info-content').height();\n        console.log(width);\n        console.log($(this));\n        $list.css('transform', 'translateY(' + ($(this).data('index') - 1) * -255 + 'px)');\n    });\n};\n\nfunction toggleSidebar() {\n    $('.sidebar').sidebar('toggle');\n}\n\nfunction ScrollTop() {\n    var body = $(\"html, body\");\n    body.stop().animate({\n        scrollTop: 0\n    }, '500');\n}\n\nfunction showScrollTop() {\n    if (!checkVisible($('#top-indicator'))) {\n        $('#vertical-nv').removeClass(\"normal\").addClass(\"pinned\");\n        $('#scroll-top').removeClass(\"out\").addClass(\"in\");\n    } else {\n        $('#vertical-nv').removeClass(\"pinned\").addClass(\"normal\");\n        $('#scroll-top').removeClass(\"in\").addClass(\"out\");\n    }\n}\n\nfunction changeToolBarPosition() {\n    var $mceToolbar = $('.mce-toolbar-grp.mce-container.mce-panel.mce-stack-layout-item.mce-first');\n    var $editorOps = $('#ops');\n    if ($mceToolbar[0]) {\n        if (!checkVisible($('.mce-top-indicator'))) {\n            $mceToolbar.addClass(\"pinned\");\n        } else {\n            $mceToolbar.removeClass(\"pinned\");\n        }\n    }\n    if ($editorOps[0]) {\n        if (!checkVisible($('footer'))) {\n            $editorOps.addClass(\"pinned\");\n        } else {\n            $editorOps.removeClass(\"pinned\");\n        }\n    }\n}\n\nfunction checkVisible(elm, evalType) {\n    evalType = evalType || 'visible';\n\n    var vpH = $(window).height();\n    // Viewport Height\n    var st = $(window).scrollTop();\n\n    // Scroll Top\n    var y = $(elm).offset().top;\n    var elementHeight = $(elm).height();\n\n    if (evalType === 'visible') return y < vpH + st && y > st - elementHeight;\n    if (evalType === 'above') return y < vpH + st;\n}\n\nfunction scrollTo(eleId) {\n    var body = $(\"html, body\");\n    body.stop().animate({\n        scrollTop: $(eleId).offset().top\n    }, '500');\n}\n\nfunction validateEmail(email) {\n    var re = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n    return re.test(email);\n}\n\nfunction showTipMsg(txt, isok) {\n    var color = isok ? 'green' : 'red';\n    $('p.tip-message').text(txt).css({\n        'background': isok ? 'rgba(55,222,88,0.3)' : 'rgba(222,55,88,0.3)',\n        'color': color,\n        'border': '1px solid ' + color\n    });\n}\n\nfunction showInputValidation(inputName, isok) {\n    var $input = $('input[name=\"' + inputName + '\"]');\n    var $inputContainer = $('.input.' + inputName);\n    if (!isok) {\n        $inputContainer.addClass('error');\n        $input.focus();\n        $input.change(function () {\n            $inputContainer.removeClass('error');\n            validateInput($input);\n        });\n    }\n    return isok;\n}\n\nfunction validateInput($input) {\n    var inputName = $input.attr('name');\n    if (inputName == 'email') {\n        return showInputValidation(inputName, validateEmail($input.val()));\n    };\n\n    if (inputName == 'password') {\n        return showInputValidation(inputName, validatePwd($input.val()));\n    };\n\n    if (inputName == 'repassword') {\n        return $input.val() === $('input[name=\"password\"]').val();\n    };\n}\n\nfunction validateInputs(issignup) {\n    if (!showInputValidation('email', validateEmail($('input[name=\"email\"]').val()))) {\n        showTipMsg('邮件格式不正确', 0);\n        return 0;\n    }\n    if (issignup) {\n        if (!showInputValidation('password', validatePwd($('input[name=\"password\"]').val()))) {\n            showTipMsg('密码至少6位，并同时包含数字和字母', 0);\n            return 0;\n        };\n\n        if (!showInputValidation('repassword', $('input[name=\"repassword\"]').val() === $('input[name=\"password\"]').val())) {\n            showTipMsg('两次密码输入不相符', 0);\n            return 0;\n        };\n    }\n    return 1;\n}\n\nfunction validatePwd(password) {\n    var regx = /^(?=.*\\d)(?=.*\\w)[\\d\\w]{6,}$/;\n    return regx.test(password);\n}\n\nfunction getQuoteText(htmlStr) {\n    var p = '';\n    $(htmlStr).find('*').each(function () {\n        if ($(this).text().length > 32) {\n            p = $(this).text();\n            return false;\n        }\n    });\n    return p;\n}","$(document).ready(function() {\r\n    setLogin();\r\n    $('.carousel').carousel({\r\n        interval: 8000\r\n    })\r\n\r\n    $('#toc').each(getTOC);\r\n    setReplistNav();\r\n    setInfoNav();\r\n\r\n    $('.user-button.button').popup({\r\n        popup: $('.user-ops-popup.popup'),\r\n        position: 'bottom right',\r\n        on: 'click'\r\n    });\r\n\r\n    if ($('#login').length) {\r\n        console.log(1);\r\n        var loginCtrl = new Vue({\r\n            el: '#login',\r\n            data: {\r\n                issignup: 0,\r\n                name: ['登录',\r\n                    '注册'\r\n                ],\r\n                submitFuncs: [login, signup]\r\n            },\r\n            methods: {\r\n                switchPage: function() {\r\n                    this.issignup = 1 - this.issignup;\r\n\r\n                },\r\n                submit: function() {\r\n                    this.submitFuncs[this.issignup]();\r\n                }\r\n            }\r\n        })\r\n    }\r\n    var scrollStatus = {\r\n        scrollRecord: [0, 0],\r\n        init: function init() {\r\n            scrollStatus.setPosition();\r\n        },\r\n        setPosition: function setPosition() {\r\n            scrollStatus.position = $(window).scrollTop();\r\n        },\r\n        recordScroll: function recordScroll() {\r\n            scrollStatus.scrollRecord[1] = scrollStatus.scrollRecord[0];\r\n            scrollStatus.scrollRecord[0] = $(window).scrollTop() > scrollStatus.position ? -1 : 1;\r\n            scrollStatus.position = $(window).scrollTop();\r\n            scrollStatus.direction = scrollStatus.scrollRecord[0] === -1 ? 'down' : 'up';\r\n            scrollStatus.continuous = scrollStatus.scrollRecord[0] === scrollStatus.scrollRecord[1];\r\n        },\r\n        adaptResize: function adaptResize() {\r\n            scrollStatus.init();\r\n        }\r\n    };\r\n    scrollStatus.init\r\n    changeToolBarPosition();\r\n    $(window).resize(scrollStatus.adaptResize);\r\n\r\n    // changeHeaderOrNot();\r\n    $(document).scroll(function() {\r\n        changeToolBarPosition();\r\n    });\r\n});\r\n\r\nfunction addTocItem($item) {\r\n    var tocContainer = $(this);\r\n    var newItem = $('<a>').attr({ 'href': $item.attr('id'), 'class': 'toc-item ' + $item.prop(\"tagName\") });\r\n    tocContainer.append(newItem);\r\n}\r\n\r\nfunction getTOC() {\r\n    console.log('adding toc')\r\n    var tocContainer = $(this);\r\n    tocContainer.addTocItem = addTocItem;\r\n    var tocTarget = $(tocContainer.data('target'));\r\n    var h2count = 0;\r\n    tocTarget.find('h2').each(function() {\r\n        $(this).attr('id', 'h2' + '-' + h2count);\r\n        tocContainer.addTocItem($(this));\r\n        var h3count = 0;\r\n        $(this).find('h3').each(function() {\r\n            $(this).attr('id', 'h3' + '-' + h2count);\r\n            tocContainer.addTocItem($(this));\r\n        })\r\n    })\r\n}\r\n\r\nfunction goBack() {\r\n    if (document.referrer.indexOf(window.location.host) !== -1) {\r\n        history.back();\r\n    }\r\n}\r\n\r\nfunction logOut() {\r\n    //remove cookies and redirect to root page\r\n    Cookies.remove('email');\r\n    Cookies.remove('username');\r\n    window.location = '/';\r\n}\r\n\r\nfunction login() {\r\n    if (!validateInputs()) return 0;\r\n\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.open('POST', '/login');\r\n\r\n    xhr.onload = function() {\r\n        var res = JSON.parse(xhr.responseText);\r\n        console.log(res);\r\n        if (res.status == '200') {\r\n            goBack();\r\n            showTipMsg('登录成功', 1);\r\n            Cookies.set('username', res.username, { expires: 7 });\r\n            Cookies.set('email', res.email, { expires: 7 });\r\n        } else if (res.status == '504') {\r\n            showTipMsg('登录失败: ' + res.msg, 0);\r\n            showInputValidation(\"email\", 0);\r\n        }\r\n    };\r\n\r\n    var formData = new FormData($('form#login')[0]);\r\n    xhr.send(formData);\r\n}\r\n\r\nfunction signup() {\r\n    if (!validateInputs(1)) return 0;\r\n\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.open('POST', '/signup');\r\n\r\n    xhr.onload = function() {\r\n        var res = JSON.parse(xhr.responseText);\r\n        if (res.status == '200') {\r\n            goBack();\r\n            showTipMsg('注册成功', 1);\r\n            Cookies.set('email', res.email, { expires: 7 });\r\n            Cookies.set('username', res.username, { expires: 7 });\r\n        } else if (res.status == '504') {\r\n            showTipMsg('注册失败: ' + res.msg, 0);\r\n            showInputValidation(\"email\", 0);\r\n        }\r\n    };\r\n\r\n    var formData = new FormData($('form#login')[0]);\r\n    xhr.send(formData);\r\n}\r\n\r\nfunction setLogin() {\r\n    if (Cookies.get('email')) {\r\n        /**\r\n         * if logged in, do:\r\n         * 1. show user pic instead of login options\r\n         * 2. set login cookies\r\n         */\r\n        $('.login-ops').addClass('hidden');\r\n        $('.user-ops').removeClass('hidden');\r\n        $('label.username').text(Cookies.get('username'));\r\n        $('.user-access-btn').addClass('disabled');\r\n\r\n        Cookies.set('email', Cookies.get('email'), { expires: 7 });\r\n        Cookies.set('username', Cookies.get('username'), { expires: 7 });\r\n    }\r\n}\r\n\r\n\r\nfunction setReplistNav() {\r\n    if (!$('.report-intro-list-nav')[0]) return;\r\n\r\n    var $list = $('.report-intro-list');\r\n    var listPos = function() {\r\n        var listLen = $('.report-intro-list .item').length;\r\n        var currentPos = 1;\r\n        return {\r\n            up: function() {\r\n                if (currentPos > 2) {\r\n                    currentPos = currentPos - 2;\r\n                } else {\r\n                    currentPos = 1;\r\n                }\r\n                $list.css('transform', 'translateY(' + (1 - currentPos) * 108 + 'px)');\r\n            },\r\n\r\n            down: function() {\r\n                if (listLen - currentPos > 2) {\r\n                    currentPos = currentPos + 2;\r\n                } else {\r\n                    currentPos = listLen - 1;\r\n                }\r\n                $list.css('transform', 'translateY(' + (1 - currentPos) * 108 + 'px)');\r\n            }\r\n        }\r\n    }();\r\n    var $up = $('.report-intro-list-nav.up').click(listPos.up);\r\n    var $down = $('.report-intro-list-nav.down').click(listPos.down);\r\n}\r\n\r\nfunction setInfoNav() {\r\n    if (!$('.info-center')[0]) return;\r\n    var $list = $('.info-content-list');\r\n    $('.service-menu .item').click(function() {\r\n        var width = $('.info-content').height();\r\n        console.log(width);\r\n        console.log($(this));\r\n        $list.css('transform', 'translateY(' + ($(this).data('index') - 1) * -255 + 'px)');\r\n    })\r\n\r\n};\r\n\r\nfunction toggleSidebar() {\r\n    $('.sidebar').sidebar('toggle');\r\n}\r\n\r\nfunction ScrollTop() {\r\n    var body = $(\"html, body\");\r\n    body.stop().animate({\r\n        scrollTop: 0\r\n    }, '500');\r\n}\r\n\r\nfunction showScrollTop() {\r\n    if (!checkVisible($('#top-indicator'))) {\r\n        $('#vertical-nv').removeClass(\"normal\").addClass(\"pinned\");\r\n        $('#scroll-top').removeClass(\"out\").addClass(\"in\");\r\n    } else {\r\n        $('#vertical-nv').removeClass(\"pinned\").addClass(\"normal\");\r\n        $('#scroll-top').removeClass(\"in\").addClass(\"out\");\r\n    }\r\n}\r\n\r\nfunction changeToolBarPosition() {\r\n    var $mceToolbar = $('.mce-toolbar-grp.mce-container.mce-panel.mce-stack-layout-item.mce-first');\r\n    var $editorOps = $('#ops');\r\n    if ($mceToolbar[0]) {\r\n        if (!checkVisible($('.mce-top-indicator'))) {\r\n            $mceToolbar.addClass(\"pinned\");\r\n        } else {\r\n            $mceToolbar.removeClass(\"pinned\");\r\n        }\r\n    }\r\n    if ($editorOps[0]) {\r\n        if (!checkVisible($('footer'))) {\r\n            $editorOps.addClass(\"pinned\");\r\n        } else {\r\n            $editorOps.removeClass(\"pinned\");\r\n        }\r\n    }\r\n}\r\n\r\nfunction checkVisible(elm, evalType) {\r\n    evalType = evalType || 'visible';\r\n\r\n    var vpH = $(window).height();\r\n    // Viewport Height\r\n    var st = $(window).scrollTop();\r\n\r\n    // Scroll Top\r\n    var y = $(elm).offset().top;\r\n    var elementHeight = $(elm).height();\r\n\r\n    if (evalType === 'visible') return y < vpH + st && y > st - elementHeight;\r\n    if (evalType === 'above') return y < vpH + st;\r\n}\r\n\r\nfunction scrollTo(eleId) {\r\n    var body = $(\"html, body\");\r\n    body.stop().animate({\r\n        scrollTop: $(eleId).offset().top\r\n    }, '500');\r\n}\r\n\r\nfunction validateEmail(email) {\r\n    var re = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n    return re.test(email);\r\n}\r\n\r\nfunction showTipMsg(txt, isok) {\r\n    var color = isok ? 'green' : 'red';\r\n    $('p.tip-message').text(txt).css({\r\n        'background': isok ? 'rgba(55,222,88,0.3)' : 'rgba(222,55,88,0.3)',\r\n        'color': color,\r\n        'border': '1px solid ' + color\r\n    });\r\n}\r\n\r\nfunction showInputValidation(inputName, isok) {\r\n    var $input = $('input[name=\"' + inputName + '\"]');\r\n    var $inputContainer = $('.input.' + inputName);\r\n    if (!isok) {\r\n        $inputContainer.addClass('error');\r\n        $input.focus();\r\n        $input.change(() => {\r\n            $inputContainer.removeClass('error');\r\n            validateInput($input);\r\n        });\r\n    }\r\n    return isok;\r\n}\r\n\r\nfunction validateInput($input) {\r\n    var inputName = $input.attr('name');\r\n    if (inputName == 'email') {\r\n        return showInputValidation(inputName, validateEmail($input.val()));\r\n    };\r\n\r\n    if (inputName == 'password') {\r\n        return showInputValidation(inputName, validatePwd($input.val()));\r\n    };\r\n\r\n    if (inputName == 'repassword') {\r\n        return $input.val() === $('input[name=\"password\"]').val();\r\n    };\r\n}\r\n\r\nfunction validateInputs(issignup) {\r\n    if (!showInputValidation('email', validateEmail($('input[name=\"email\"]').val()))) {\r\n        showTipMsg('邮件格式不正确', 0);\r\n        return 0;\r\n    }\r\n    if (issignup) {\r\n        if (!showInputValidation('password', validatePwd($('input[name=\"password\"]').val()))) {\r\n            showTipMsg('密码至少6位，并同时包含数字和字母', 0);\r\n            return 0;\r\n        };\r\n\r\n        if (!showInputValidation('repassword', $('input[name=\"repassword\"]').val() === $('input[name=\"password\"]').val())) {\r\n            showTipMsg('两次密码输入不相符', 0);\r\n            return 0;\r\n        };\r\n    }\r\n    return 1;\r\n}\r\n\r\nfunction validatePwd(password) {\r\n    var regx = /^(?=.*\\d)(?=.*\\w)[\\d\\w]{6,}$/;\r\n    return regx.test(password);\r\n}\r\n\r\nfunction getQuoteText(htmlStr) {\r\n    var p = '';\r\n    $(htmlStr).find('*').each(function() {\r\n        if ($(this).text().length > 32) {\r\n            p = $(this).text();\r\n            return false;\r\n        }\r\n    });\r\n    return p;\r\n}\r\n"],"sourceRoot":"/source/"}