"use strict";var myUpload=function(){function t(t){$("#loader").modal("show");var e=$("#loader").find(".loader"),a=function(a){e.text("uploading "+a+"of "+t.length)};_.forEach(t,function(t,e){e++,a(e),data={date:GetCurrentDate(),type:$("#upload-type").val(),title:t.title,name:t.name,source:t.source,path:t.path},console.log(data),$.post("/add_new_post",data,function(t){$("#loader").modal("hide"),console.log(t)})}),loadContent("/home")}function e(t){var e;return $(t).find("*").each(function(){return $(this).text().length>32?(e=$(this).text(),!1):void 0}),e}function a(){var t=this;this.title="",this.name="",this.source="",this.path="",this.progress="0%",this.updateProgress=function(e){t.progress=computProgress(e)};var e=new XMLHttpRequest;e.withCredentials=!1,e.open("POST","/files"),e.onload=function(){var a=JSON.parse(e.responseText);t.path=a.location},e.upload.addEventListener("progress",this.updateProgress,!1),this.uploadFile=function(a){t.name=a.files[0].name;var n=$(a).parent(".frmfile")[0],i=new FormData(n);e.send(i)},this.abort=function(){e.abort()}}function n(){var t={atts:{}},e=0;return t.states=[],t.addAtt=function(){t.states.push(0),e++;var n="att"+e,i=new a;t.atts[n]=i;var o=$("<form>").attr({"class":"frmfile",enctype:"multipart/form-data",method:"post",hidden:1}),d=$("<input>").attr({id:"iptfile"+e,type:"file",name:"file"+e,hidden:1}).change(function(){i.uploadFile(this)});return $("body").append(o.append(d)),d.click(),i},t.wrapUp=function(){var t="";return _.forEach(i.atts,function(e,a){a++,t+="<p>附件."+a+'： <a href="'+e.path+'" download="'+e.name+'">'+e.name+"</a></p>"}),t},t}var i,o={};return o.init=function(a){if(console.log(a),"refe"==a){$(".news-only").hide(),$(".data-only").hide(),$(".refe-only").show(),$("#btn-add").show(),i=new Vue({el:"#app-r",data:{refes:[]},methods:{remove:function(t){t.abort(),this.refes.$remove(t)}}});var d=n();$("#btn-add").off("click"),$("#btn-add").click(function(){i.refes.push(d.addAtt())}),$("#btn-upload").off("click"),$("#btn-upload").click(function(){t(i.refes)})}else if("data"==a){$(".news-only").hide(),$(".refe-only").hide(),$(".data-only").show(),$("#btn-add").show(),i=new Vue({el:"#app-d",data:{datas:[]},methods:{remove:function(t){t.abort(),this.datas.$remove(t)}}});var r=n();$("#btn-add").off("click"),$("#btn-add").click(function(){i.datas.push(r.addAtt())}),$("#btn-upload").off("click"),$("#btn-upload").click(function(){t(i.datas)})}else{$(".news-only").show(),$(".refe-only").show(),$(".data-only").hide(),$(".refe-only").hide(),$("#btn-add").hide(),$("#upload-type").change(function(){o.init($(this).val())});var s=n();tinymce.EditorManager.remove("#input-body"),$("#btn-add").hide(),tinymce.init({selector:"#input-body",plugins:"advlist link anchor paste image autoresize preview imagetools",toolbar:"undo redo formatselect advlist fontsizeselect bold italic underline strikethrough alignleft aligncenter alignright link image preview",image_caption:!0,paste_data_images:!0,fontsize_formats:"8pt 9pt 10pt 11pt 12pt 14pt 18pt 24pt 36pt",menubar:!1,images_upload_url:"/images",content_css:"stylesheets/style.min.css",min_width:420,max_height:960}),i=new Vue({el:"#app",data:{atts:[]},methods:{remove:function(t){t.abort(),this.atts.$remove(t)}}}),$("#input-img").off("change"),$("#input-img").change(function(){if(this.files&&this.files[0]){var t=new FileReader;t.onload=function(t){tinymce.activeEditor.execCommand("insertHTML",!1,'<img src="'+t.target.result+'" width="80%" >'),tinymce.activeEditor.uploadImages()},t.readAsDataURL(this.files[0])}}),$("#input-date").val(GetCurrentDate()),$("#btn-att").off("click"),$("#btn-att").click(function(){i.atts.push(s.addAtt())}),$("#btn-upload").off("click"),$("#btn-img").click(function(){$("#input-img").click()}),$("#btn-upload").off("click"),$("#btn-upload").click(function(){$("#loader").modal("show");var t=$("#loader").find(".loader");t.text("uploading Images"),tinymce.activeEditor.uploadImages(function(a){t.text("wrapping together"),tinymce.activeEditor.save();var n=s.wrapUp(i.atts),o={type:$("#upload-type").val(),title:$("#input-title").val(),date:$("#input-date").val(),owner:Cookies.get("username"),source:$("#input-source").val(),cover:$($("#input-body").val()).find("img").attr("src"),quote:e($("#input-body").val()),body:$("#input-body").val()+n,att:n};t.text("pendding"),$.post("/add_new_post",o,function(t){$("#loader").modal("hide"),loadContent(t.url)})})})}},o}();
//# sourceMappingURL=../maps/mymce.babeled.min.js.map
